<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="view_invoice_tree" model="ir.ui.view">
           <field name="name">account.move.search</field>
           <field name="model">account.move</field>
           <field name="inherit_id" ref="account.view_invoice_tree" />
           <field name="arch" type="xml">

               <xpath expr="//field[@name='invoice_date_due']" position="replace" >
                   <field name="invoice_date_due" widget="remaining_days" optional="hide" attrs="{'invisible': [['payment_state', 'in', ('paid', 'in_payment', 'reversed')]]}"/>

               </xpath>

               <xpath expr="//field[@name='activity_ids']" position="replace" >
                   <field name="activity_ids" widget="list_activity" optional="hide" />
                   <field name="proveedores_land" />

               </xpath>

               <xpath expr="//field[@name='invoice_partner_display_name']" position="after" >
                   <field name="identification_type" />
                   <field name="l10n_pe_vat_code" />
                   <field name="vat" />
                   <field name="bank_name" />
                   <field name="bank_operation" />
                   <field name="bank_date" />
               </xpath>

               <xpath expr="//field[@name='amount_total_in_currency_signed']" position="replace" >
                   <field name="amount_total_in_currency_signed" string="Total in Currency"
                      groups="base.group_multi_currency" optional="hide"/>

               </xpath>

               <xpath expr="//field[@name='payment_state']" position="replace" >
                   <field name="payment_state" widget="badge" decoration-danger="payment_state == 'not_paid'"
                          decoration-warning="payment_state in ('partial', 'in_payment')"
                          decoration-success="payment_state in ('paid', 'reversed')"
                          attrs="{'invisible': [('payment_state', 'in', ('invoicing_legacy'))]}"
                          optional="hide"/>

               </xpath>






           </field>
    </record>

    <record id="edit_account_move_line" model="ir.ui.view">
           <field name="name">Account.Move.Line.Form</field>
           <field name="model">account.move.line</field>
           <field name="arch" type="xml">
               <form>
                   <sheet>
                       <group>
                           <field name="name" />
                       </group>
                   </sheet>
               </form>
           </field>
    </record>



    <record id="view_account_invoice_filter" model="ir.ui.view">
           <field name="name">account.move.search</field>
           <field name="model">account.move</field>
           <field name="inherit_id" ref="account.view_account_invoice_filter" />
           <field name="arch" type="xml">


               <xpath expr="//field[@name='date']" position="after" >



                   <filter name="is_active" string="Separaciones Activas"
                           domain="[('stage_separation_land', '=', 'active')]"
                   />
                   <filter name="is_active" string="Separaciones Caidas"
                           domain="[('stage_separation_land', '=', 'down')]"
                   />
                   <filter name="is_active" string="Separaciones con Inicial"
                           domain="[('stage_separation_land', '=', 'initial')]"
                   />

                   <filter name="is_mora" string="Tiene Mora de Terreno" domain="[('invoice_line_ids.product_id.is_mora_land', '=', True)]"/>
                   <filter name="is_advanced" string="Tiene Inicial/Adelanto de Terreno" domain="[('invoice_line_ids.product_id.is_advanced_land', '=', True)]"/>
                   <filter name="is_separation" string="Es SeparaciÃ³n de Terreno" domain="['|',('invoice_line_ids.product_id.is_separation_land', '=', True),('is_separation_land','=',True)]"/>
                   <filter name="is_payment_land_dues" string="Es Pago de Cuota de Terreno" domain="[('invoice_line_ids.product_id.payment_land_dues', '=', True)]"/>
                   <filter name="is_anticipo" string="Tiene Anticipo de Terreno" domain="[('invoice_line_ids.product_id.is_anticipo_land', '=', True)]"/>

                   <group expand="0" string="Group By">
                        <filter string="Estado Separacion" name="group_by_stage_separation" context="{'group_by': 'stage_separation_land'}" />
                    </group>
               </xpath>
           </field>
    </record>


    <record id="view_move_form" model="ir.ui.view">
           <field name="name">account.move.Form</field>
           <field name="model">account.move</field>
           <field name="inherit_id" ref="account.view_move_form" />
           <field name="arch" type="xml">

               <xpath expr="//field[@name='invoice_line_ids']/tree/field[@name='quantity']" position="after" >
                   <field name="parent_state" invisible="1" />
                   <button name="next_due_land" type="object"
                           confirm="Esta agregara una nueva cuota en una nueva linea de esta misma factura"
                           icon="fa-clone"   />



               </xpath>




               <xpath expr="//field[@name='invoice_line_ids']/tree/field[@name='name']" position="after" >
                   <field name="parent_state" invisible="1" />
                   <button name="edit_desc_jz" type="object"
                           groups="land.show_edit_descripcion_move"
                           confirm="Modificar solo si es necesario!!!!!!!"
                           icon="fa-pencil-square-o"   />
               </xpath>


               <xpath expr="//field[@name='invoice_vendor_bill_id']" position="after" >
                   <field name="mz_land_separation_id" attrs="{'invisible': [('is_separation_land','!=',True)] , 'required':  [('is_separation_land','=',True)]  }" />
                   <field name="lot_land_separation_id"  attrs="{'invisible': [('is_separation_land','!=',True)] , 'required':  [('is_separation_land','=',True)] }" />
                   <field name="sector_land_separation_id"  attrs="{'invisible': [('is_separation_land','!=',True)] , 'required':  [('is_separation_land','=',True)] }" />
                   <field name="stage_separation_land" attrs="{'invisible': [('is_separation_land','!=',True)] , 'required':  [('is_separation_land','=',True)] }" />
               </xpath>

               <xpath expr="//field[@name='partner_bank_id']" position="after" >


                   <!-- Invoice payment terms (only invoices) + due date (only invoices / receipts) -->
                   <div class="o_td_label"
                        attrs="{'invisible': [
                        '|',
                        ('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt')),
                        ('is_separation_land','!=',True)
                        ]}">
                       <label for="invoice_date_due_separation" string="Fecha Vencimiento Separacion"  />
                       <!--<label for="invoice_payment_term_id" string="Payment terms" attrs="{'invisible': [('invoice_payment_term_id', '=', False)]}"/> -->
                   </div>
                   <div class="d-flex"
                        attrs="{'invisible': [
                                '|',
                                ('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt')) ,
                                ('is_separation_land','!=',True)
                        ]}"
                   >

                       <field name="days_max_due_separation" />
                       <span class="o_form_label mx-3 oe_edit_only" attrs="{'invisible': ['|', ('state', '!=', 'draft'), ('invoice_payment_term_id', '!=', False)]}"> or </span>
                       <field name="invoice_date_due_separation" force_save="1" placeholder="Date" />

                   </div>

               </xpath>


               <xpath expr="//header" position="inside" >
                   <button name="create_sale_if_separation" string="Crear Cotizacion" type="object"
                           attrs="{'invisible' : ['|',('is_separation_land', '=', False),('state','!=','posted')]}" />
               </xpath>

               <xpath expr="//field[@name='qr_code_method']" position="after" >
                   <field name="is_separation_land"  />
                   <field name="is_initial_land" />

               </xpath>

               <xpath expr="//field[@name='narration']" position="replace" >
                   <field name="narration"
                          attrs="{'invisible': [('narration', '=', False)]}"
                          placeholder="Terms and Conditions"
                          colspan="2" nolabel="1"/>

                   <field name="narration_str"  invisible="1" />

                   <field name="narration_text" placeholder="Terms and Conditions"
                          colspan="2" nolabel="1"/>

               </xpath>


               <xpath expr="//page[@name='invoice_tab']" position="inside" >
                   <group>
                       <field name="bank_origin_ids" >
                           <tree editable="bottom"  >
                               <field name="bank_id" />
                               <field name="operation_number" />
                               <field name="date" />

                           </tree>
                       </field>
                   </group>

               </xpath>
           </field>
    </record>


    <record id="view_move_form_odoofact" model="ir.ui.view">
           <field name="name">account.move.Form</field>
           <field name="model">account.move</field>
           <field name="inherit_id" ref="l10n_pe_edi_odoofact.view_move_form" />
           <field name="arch" type="xml">
               <xpath expr="//button[@name='action_document_send']" position="replace" >
                   <button class="oe_stat_button text-info" type="object" name="action_document_send"
                           confirm="Esta Seguro de Enviar? , asegurese revisar el reporte impreso PDF para verificar datos  (puede enviarlo esto al cliente y luego enviarlo a la SUNAT)"
                           icon="fa-cloud-upload" string="Send to SUNAT"
                           attrs="{'invisible': ['|', '|', '|', ('l10n_pe_edi_ose_accepted', '=', True), ('state', '!=', 'posted'), ('l10n_pe_edi_is_einvoice', '=', False), ('l10n_pe_edi_request_id', '=', False)]}"/>

               </xpath>
           </field>
    </record>


    <record id="view_invoice_tree_jz" model="ir.ui.view">
           <field name="name">account.move.tree</field>
           <field name="model">account.move</field>
           <field name="arch" type="xml">
              <tree string="Invoices" js_class="account_tree"
                    decoration-info="state == 'draft'"
                    decoration-muted="state == 'cancel'"
                    decoration-danger=" days_count_expired_separation > -6 "
                    expand="context.get('expand', False)" sample="1">

                    <field name="made_sequence_hole" invisible="1"/>
                    <field name="name" decoration-bf="1" decoration-danger="made_sequence_hole"/>
                    <field name="invoice_partner_display_name" invisible="context.get('default_move_type') not in ('in_invoice', 'in_refund','in_receipt')" groups="base.group_user" string="Vendedor"/>
                    <field name="invoice_partner_display_name" invisible="context.get('default_move_type') not in ('out_invoice', 'out_refund','out_receipt')" groups="base.group_user" string="Cliente"/>
                    <field name="invoice_date" optional="show" invisible="context.get('default_move_type') not in ('in_invoice', 'in_refund','in_receipt')" string="Bill Date"/>
                    <field name="invoice_date" optional="show" invisible="context.get('default_move_type') not in ('out_invoice', 'out_refund','out_receipt')" string="Fecha Factura"/>
                    <field name="date" optional="hide" string="Accounting Date"/>
                    <field name="invoice_date_due_separation" widget="remaining_days" optional="show"  />
                    <field name="invoice_date_due" widget="remaining_days" optional="hide" attrs="{'invisible': [['payment_state', 'in', ('paid', 'in_payment', 'reversed')]]}"/>
                    <field name="invoice_origin" optional="hide" string="Source Document"/>
                    <field name="payment_reference" optional="hide" invisible="context.get('default_move_type') in ('out_invoice', 'out_refund','out_receipt')"/>
                    <field name="ref" optional="hide" />
                    <field name="narration" optional="hide" />
                    <field name="invoice_user_id" optional="hide" invisible="context.get('default_move_type') not in ('out_invoice', 'out_refund','out_receipt')" string="Salesperson" widget="many2one_avatar_user"/>
                    <!--<field name="activity_ids" widget="list_activity" optional="show"/> -->
                    <field name="company_id" groups="base.group_multi_company" options="{'no_create': True}" optional="hide"/>
                    <field name="company_id" groups="!base.group_multi_company" invisible="1"/>
                    <field name="amount_untaxed_signed" string="Tax Excluded" sum="Total" optional="hide"/>
                    <field name="amount_tax_signed" string="Tax" sum="Total" optional="hide"/>
                    <field name="amount_total_signed" string="Total" sum="Total" decoration-bf="1" optional="show"/>
                    <field name="amount_total_in_currency_signed" string="Total in Currency" groups="base.group_multi_currency" optional="hide"/>
                    <field name="amount_residual_signed" string="Amount Due" sum="Amount Due" optional="hide"/>
                    <field name="currency_id" groups="base.group_multi_currency" optional="hide"/>
                    <field name="company_currency_id" invisible="1"/>
                    <field name="to_check" optional="hide" widget="boolean_toggle"/>
                    <field name="payment_state" widget="badge" decoration-danger="payment_state == 'not_paid'"
                           decoration-warning="payment_state in ('partial', 'in_payment')"
                           decoration-success="payment_state in ('paid', 'reversed')" attrs="{'invisible': [('payment_state', 'in', ('invoicing_legacy'))]}"
                           optional="hide" />
                    <field name="stage_separation_land"
                            widget="badge"
                           decoration-success="stage_separation_land == 'active'"
                           decoration-info="stage_separation_land == 'initial'"
                           decoration-danger="stage_separation_land == 'down'"
                    />
                    <field name="state" widget="badge" decoration-success="state == 'posted'" decoration-info="state == 'draft'" optional="show"/>


                    <field name="move_type" invisible="context.get('default_move_type', True)"/>
                    <field name="l10n_pe_edi_ose_accepted"  optional="hide" />
                    <field name="l10n_pe_edi_sunat_accepted"  optional="hide" />
                    <field name="days_count_expired_separation"  optional="hide" />

                  </tree>
           </field>
    </record>

    <record id="update_date_nubefact" model="ir.actions.server">
			<field name="name">Actualizar Fechas Nubefact</field>
			<field name="model_id" ref="land.model_account_move"/>
			<field name="binding_model_id" ref="land.model_account_move"/>
			<field name="state">code</field>
			<field name="code">action = records.validate_date_nubefact()</field>
    </record>

</odoo>