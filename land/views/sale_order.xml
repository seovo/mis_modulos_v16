<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_order_form" model="ir.ui.view">
           <field name="name">Pedidos.Form</field>
           <field name="model">sale.order</field>
           <field name="inherit_id" ref="sale.view_order_form" />
           <field name="arch" type="xml">

               <xpath expr="//header" position="inside" >
                   <button name="show_m2_land" string="Modificar Metrado" type="object"  />
                   <button name="update_schedule" string="Actualizar Cronograma" type="object"  />
                   <button name="show_lot_availables" string="Mostrar Lotes" type="object"  />

               </xpath>

               <xpath expr="//field[@name='order_line']/tree/field[@name='price_unit']" position="replace" >
                   <field name="price_unit"  readonly="1"  force_save="1" />
                   <button name="edit_price_jz" type="object" icon="fa-pencil-square-o" />
               </xpath>

               <xpath expr="//notebook" position="inside" >
                   <page string="Terreno InformaciÃ³n" >
                       <group>
                           <field name="nro_internal_land" />
                           <field name="mz_lot" />
                           <field name="sector" />
                           <field name="stage_land" />

                           <field name="dues_land" />
                           <field name="value_due_land" />
                           <field name="crono_land" />
                           <field name="days_tolerance_land" />
                           <field name="value_mora_land" />
                           <field name="percentage_refund_land" />
                           <field name="date_sign_land" />

                           <field name="start_date_schedule_land" />
                           <field name="modality_land" />
                           <field name="obs_modality_land" />
                           <field name="recalcule_and_save_total_land" />
                           <field name="price_total_land" />
                           <field name="price_initial_land" />
                           <field name="price_credit_land" />
                           <field name="move_separation_land_id" />
                           <field name="stage_payment_lan" />
                           <field name="last_payment_date_land" />
                           <field name="next_payment_date_land" />
                           <field name="days_expired_land" />
                       </group>
                   </page>
                   <page string="Cronograma">
                       <field name="schedule_land_ids"
                              create="false"
                              delete="false"
                            >
                                <tree string="Sales" >
                                    <field name="number_due" readonly="1"  />
                                    <field name="date" readonly="1" />
                                    <field name="balan" readonly="1"  />
                                    <field name="amount" readonly="1"   />
                                    <field name="note"  readonly="1"  />
                                    <field name="is_paid" readonly="1"   />
                                    <field name="amount_due_land"  />
                                    <field name="amount_mora_land"  />
                                    <field name="note"  />
                                </tree>
                       </field>




                   </page>

               </xpath>

               <xpath expr="//field[@name='partner_shipping_id']" position="after" >
                   <field name="seller_land_id"  widget="selection" />
                   <field name="date_sign_land" />
                   <field name="type_periodo_invoiced" />
                   <field name="date_first_due_land" />


                   <field name="mz_land" />
                   <field name="lot_land" />
                   <field name="sector_land" />
                   <field name="m2_land" />
               </xpath>



           </field>
    </record>

    <record id="edit_sale_order_line" model="ir.ui.view">
           <field name="name">Pedidos.Form</field>
           <field name="model">sale.order.line</field>
           <field name="arch" type="xml">
               <form>
                   <sheet>
                       <group>
                           <field name="price_unit" />
                       </group>
                   </sheet>
               </form>
           </field>
    </record>

    <record id="view_sales_order_filter" model="ir.ui.view">
           <field name="name">sale.order.Form</field>
           <field name="model">sale.order</field>
           <field name="inherit_id" ref="sale.view_sales_order_filter" />
           <field name="arch" type="xml">


               <xpath expr="//field[@name='order_line']" position="after" >
                   <filter name="vencido_x_vencer" string="Vencidos / Proximos a Vencer"
                           domain="[('last_payment_date_land', '&lt;', ( context_today() - relativedelta(days=20)).strftime('%Y-%m-%d')  )  ]"
                   />
                   <field name="nro_internal_land"  />
                   <field name="mz_lot" string="Manzana-Lote" />
                   <field name="order_line" string="Manzana" filter_domain="[('order_line.product_id.manzana', 'ilike', self)]"/>
                   <field name="order_line" string="Lote" filter_domain="[('order_line.product_id.lote', 'ilike', self)]"/>
               </xpath>
           </field>
    </record>


    <record id="view_order_tree" model="ir.ui.view">
           <field name="name">sale.order.Form</field>
           <field name="model">sale.order</field>
           <field name="inherit_id" ref="sale.view_order_tree" />
           <field name="arch" type="xml">
               <xpath expr="//field[@name='name']" position="after" >
                   <field name="nro_internal_land"  />
                   <field name="mz_lot" string="Manzana-Lote" />
                   <field name="last_payment_date_land" widget="remaining_days" />
                   <field name="next_payment_date_land"  />

               </xpath>
           </field>
    </record>


    <record id="view_quotation_tree" model="ir.ui.view">
           <field name="name">sale.order.Form</field>
           <field name="model">sale.order</field>
           <field name="inherit_id" ref="sale.view_quotation_tree" />
           <field name="arch" type="xml">
               <xpath expr="//field[@name='name']" position="after" >
                   <field name="nro_internal_land"  />
                   <field name="mz_lot" string="Manzana-Lote" />
                   <field name="last_payment_date_land" widget="remaining_days" />
                   <field name="next_payment_date_land"  />
               </xpath>
           </field>
    </record>


    <!--  -->


    <record id="action_move_adelantos" model="ir.actions.act_window">
        <field name="name">Separaciones</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">account.move</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('is_separation_land','=',True),('move_type', '=', 'out_invoice'),('sale_order_count_store','=',0)]</field>
        <field name="context">{'default_is_separation_land': True , 'default_move_type': 'out_invoice' }</field>
        <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('land.view_invoice_tree_jz')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('account.view_move_form')})]"
            />
    </record>

    <menuitem action="action_move_adelantos"
              id="menu_move_adelantos"
              parent="sale.sale_order_menu"
    />


    <record id="action_sale_initial_incomplete" model="ir.actions.act_window">
        <field name="name">Expediente Inicial Incompleta</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.order</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('stage_payment_lan','=','initial')]</field>
    </record>

    <menuitem action="action_sale_initial_incomplete"
              id="menu_sale_initial_incomplete"
              parent="sale.sale_order_menu"
    />

    <record id="action_sale_dues_incomplete" model="ir.actions.act_window">
        <field name="name">Expedientes en Proceso de Pago</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.order</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('stage_payment_lan','=','dues'),('state','in',['sale','done'])]</field>
        <!--<field name="context">{'search_default_vencido_x_vencer': 1}</field> -->
        <field name="context">{}</field>
    </record>

    <menuitem action="action_sale_dues_incomplete"
              id="menu_sale_dues_incomplete"
              parent="sale.sale_order_menu"
    />

    <record id="action_sale_dues_complete" model="ir.actions.act_window">
        <field name="name">Expendientes Pagos Completados</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.order</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('stage_payment_lan','=','completed')]</field>
    </record>

    <menuitem action="action_sale_dues_complete"
              id="menu_sale_dues_complete"
              parent="sale.sale_order_menu" />


</odoo>