<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="view_order_form_due" model="ir.ui.view">
           <field name="name">Pedidos.Form</field>
           <field name="model">sale.order</field>
           <field name="priority">1000</field>

           <field name="arch" type="xml">
               <form>
                   <sheet>
                       <group>
                           <group>
                               <field name="company_id"  invisible="1"/>
                               <field name="nro_internal_land"  readonly="1"/>
                               <field name="amount_total" readonly="1" />
                               <field name="price_initial_land" string="Inicial"  readonly="1" />
                           </group>
                           <group>
                               <field name="price_credit_land" string="Credito" readonly="1" />
                               <field name="total_payment_land" string="Abonado" readonly="1" />
                               <field name="saldo_payment_land"  string="Saldo" readonly="1" />

                           </group>


                       </group>
                       <notebook>
                           <page string="Cronograma" name="cronograma">
                       <field name="schedule_land_ids"
                              create="false"
                              delete="false"
                            >
                                <tree string="Sales" readonly="1" >
                                    <field name="is_paid" readonly="1"   />
                                    <field name="number_due" readonly="1"  />
                                    <field name="date" readonly="1" />
                                    <field name="invoice_date" />
                                    <field name="balan" readonly="1" optional="hide" />
                                    <field name="amount" readonly="1"   />
                                    <field name="note"  readonly="1" optional="hide" />


                                    <field name="amount_due_land"  />
                                    <field name="amount_mora_land"  />

                                </tree>
                       </field>




                   </page>

                           <page string="Mora" >
                       <group>
                           <group>
                               <field name="partner_id" readonly="1"  />
                               <field name="mz_lot"  readonly="1" />
                               <field name="value_due_land" readonly="1"  />
                               <field name="last_payment_date_land"  readonly="1" />
                               <field name="next_payment_date_land"  readonly="1" />
                               <field name="days_tolerance_land" readonly="1" />
                               <field name="dues_land" readonly="1" />
                               <field name="qty_dues_payment" readonly="1" />

                           </group>


                           <group string="Total a Pagar" >
                               <field name="days_expired_land"  readonly="1" />
                               <field name="value_mora_land"  readonly="1" />
                               <field name="mora_acumulada" readonly="1"  />
                               <field name="mounth_expired_land"  readonly="1" />
                               <field name="amount_payment_month_land"  readonly="1" />
                               <field name="amount_total_payment_month_land" readonly="1"  />

                           </group>




                       </group>
                   </page>

                       </notebook>
                   </sheet>
               </form>

           </field>
    </record>


    <record id="view_order_form" model="ir.ui.view">
           <field name="name">Pedidos.Form</field>
           <field name="model">sale.order</field>
           <field name="inherit_id" ref="sale.view_order_form" />
           <field name="arch" type="xml">

               <xpath expr="//header" position="inside" >
                   <button name="show_m2_land" string="Modificar Metrado" type="object"  />
                   <button name="update_schedule" string="Actualizar Cronograma" type="object"  />
                   <button name="show_lot_availables" string="Mostrar Lotes" type="object"  />
                   <button name="update_dates_land" string="Reorganizar Fechas" type="object" groups="land.group_reordenate_date_sale"  />

               </xpath>

               <xpath expr="//field[@name='order_line']/tree/field[@name='price_unit']" position="replace" >
                   <field name="price_unit"  readonly="1"  force_save="1" />
                   <button name="edit_price_jz" type="object" icon="fa-pencil-square-o" />
               </xpath>

               <xpath expr="//notebook" position="inside" >
                   <page string="Terreno InformaciÃ³n" >
                       <group>

                           <field name="days_tolerance_land" />
                           <field name="value_mora_land" />
                           <field name="percentage_refund_land" />
                           <field name="modality_land" />
                           <field name="obs_modality_land" />
                           <field name="obs_resolution" />
                           <field name="recalcule_and_save_total_land"  readonly="1" force_save="1" />
                           <field name="price_total_land"  readonly="1" force_save="1" />
                           <field name="price_initial_land"  readonly="1" force_save="1" />
                           <field name="price_credit_land"  readonly="1" force_save="1" />
                           <field name="move_separation_land_id"  readonly="1" force_save="1" />
                           <field name="stage_payment_lan" />


                           <field name="crono_land" invisible="1" />
                           <field name="sectorr" />
                           <field name="sector" />
                           <field name="mz_lot"  readonly="1" force_save="1" />
                           <field name="dues_land" readonly="1" force_save="1" />
                           <field name="value_due_land" readonly="1" force_save="1" />
                       </group>
                   </page>
                   <page string="Cronograma">

                       <group>
                           <group>
                               <field name="price_credit_land" readonly="1" force_save="1" />
                               <field name="total_payment_land" readonly="1" force_save="1" />
                               <field name="saldo_payment_land" readonly="1" force_save="1" />
                           </group>
                           <group>
                               <button name="recreate_schedule" string="Recrear Cronograma" type="object"  />
                               <button name="publish_invoice"
                                       groups="land.group_reordenate_date_sale"
                                       confirm="Haga esto solo si esta seguro que desea confirmar las facturas en estado borrador y estan correcto los datos como monto y fecha"
                                       string="Publicar Facturas Portal Sunat" type="object"  />
                           </group>

                       </group>

                       <field name="schedule_land_ids"
                              create="false"
                              delete="false"
                            >
                                <tree string="Sales"   editable="bottom">
                                    <field name="number_due" readonly="1"  />
                                    <button name="invoice_here_land" string="Pagar"
                                            groups="land.group_payment_cronograma"
                                            type="object"  />
                                    <field name="date" readonly="1" />
                                    <field name="invoice_date" optional="show" readonly="1"  />
                                    <field name="balan" readonly="1"  />
                                    <field name="amount" readonly="1"   />
                                    <field name="note"  readonly="1"  />
                                    <field name="is_paid" readonly="1"   />
                                    <field name="move_id"  optional="show" />

                                    <field name="amount_due_land"  />
                                    <field name="amount_mora_land"  />
                                    <field name="note"  />

                                </tree>
                       </field>

                   </page>
                   <page string="Mora" >
                       <group>
                           <group>
                               <field name="partner_id" />
                               <field name="mz_lot"  readonly="1" />
                               <field name="value_due_land" readonly="1"  />
                               <field name="last_payment_date_land"  readonly="1" />
                               <field name="next_payment_date_land"  readonly="1" />
                               <field name="days_tolerance_land" readonly="1" />
                               <field name="dues_land" readonly="1" />
                               <field name="qty_dues_payment" readonly="1" />

                           </group>


                           <group string="Total a Pagar" >
                               <field name="days_expired_land"  readonly="1" />
                               <field name="value_mora_land"  readonly="1" />
                               <field name="mora_acumulada" readonly="1"  />
                               <field name="mounth_expired_land"  readonly="1" />
                               <field name="amount_payment_month_land"  readonly="1" />
                               <field name="amount_total_payment_month_land" readonly="1"  />

                           </group>




                       </group>
                   </page>

               </xpath>

               <xpath expr="//field[@name='partner_shipping_id']" position="after" >
                   <field name="seller_land_id"  widget="selection" />
                   <field name="date_sign_land" />
                   <field name="type_periodo_invoiced" />
                   <field name="date_first_due_land" />
                   <field name="nro_internal_land" />
                   <field name="stage_land" />

               </xpath>

               <xpath expr="//field[@name='payment_term_id']" position="after" >
                   <field name="mz_land" />
                   <field name="lot_land" />
                   <field name="sector_land" />
                   <field name="m2_land" />
                   <field name="user_id" />
                   <field name="commision_lan" />


               </xpath>





           </field>
    </record>

    <record id="edit_sale_order_line" model="ir.ui.view">
           <field name="name">Pedidos.Form</field>
           <field name="model">sale.order.line</field>
           <field name="arch" type="xml">
               <form>
                   <sheet>
                       <group>
                           <field name="company_id"  invisible="1" />
                           <field name="price_unit" />
                           <field name="add_separation_land" />
                           <field name="product_template_id"
                                  groups="land.group_edit_attr_mz_lot" />
                           <field name="product_id" groups="land.group_edit_mz_lot" />

                           <field name="land_area_id"
                                  domain="[('attribute_id.type_land', '=', 'm2'),('product_tmpl_id','=',product_template_id)]"
                                  groups="land.group_edit_attr_mz_lot" />
                           <field name="land_mz_id"
                                  domain="[('attribute_id.type_land', '=', 'mz'),('product_tmpl_id','=',product_template_id)]"
                                  groups="land.group_edit_attr_mz_lot" />
                           <field name="land_lote_id"
                                  domain="[('attribute_id.type_land', '=', 'lot'),('product_tmpl_id','=',product_template_id)]"
                                  groups="land.group_edit_attr_mz_lot" />
                           <field name="land_stage_id" groups="land.group_edit_attr_mz_lot"
                                  domain="[('attribute_id.type_land', '=', 'stage'),('product_tmpl_id','=',product_template_id)]"
                           />



                       </group>
                   </sheet>
               </form>
           </field>
    </record>

    <record id="view_sales_order_filter" model="ir.ui.view">
           <field name="name">sale.order.Form</field>
           <field name="model">sale.order</field>
           <field name="inherit_id" ref="sale.view_sales_order_filter" />
           <field name="arch" type="xml">


               <xpath expr="//field[@name='order_line']" position="after" >
                   <filter name="vencido_x_vencer" string="Vencidos / Proximos a Vencer"
                           domain="[('last_payment_date_land', '&lt;', ( context_today() - relativedelta(days=20)).strftime('%Y-%m-%d')  )  ]"
                   />
                   <field name="nro_internal_land"  />
                   <field name="mz_lot" string="Manzana-Lote" />
                   <field name="order_line" string="Manzana" filter_domain="[('order_line.product_id.manzana', 'ilike', self)]"/>
                   <field name="order_line" string="Lote" filter_domain="[('order_line.product_id.lote', 'ilike', self)]"/>
               </xpath>
           </field>
    </record>


    <record id="view_order_tree" model="ir.ui.view">
           <field name="name">sale.order.Form</field>
           <field name="model">sale.order</field>
           <field name="inherit_id" ref="sale.view_order_tree" />
           <field name="arch" type="xml">
               <xpath expr="//field[@name='name']" position="after" >
                   <field name="nro_internal_land"  />
                   <field name="mz_lot" string="Manzana-Lote" />
                   <field name="stage_payment_lan" widget="badge"
                                           decoration-success="stage_payment_lan == 'payment'"
                                           decoration-warning="stage_payment_lan == 'initial'"
                                    />
                   <field name="last_payment_date_land" widget="remaining_days" />
                   <field name="next_payment_date_land"  />

               </xpath>
           </field>
    </record>


    <record id="view_quotation_tree" model="ir.ui.view">
           <field name="name">sale.order.Form</field>
           <field name="model">sale.order</field>
           <field name="inherit_id" ref="sale.view_quotation_tree" />
           <field name="arch" type="xml">
               <xpath expr="//field[@name='name']" position="after" >
                   <field name="nro_internal_land"  />
                   <field name="mz_lot" string="Manzana-Lote" />
                   <field name="last_payment_date_land" widget="remaining_days" />
                   <field name="next_payment_date_land"  />
               </xpath>
           </field>
    </record>


    <!--  -->

    <record id="view_order_tree_separacion" model="ir.ui.view">
           <field name="name">sale.order.Form</field>
           <field name="model">sale.order</field>
           <field name="arch" type="xml">
               <tree string="Ventas"
                                      decoration-danger="days_expired_land >= 15"
                                       decoration-warning="days_expired_land >= 10"
                                >
                                    <field name="nro_internal_land" />
                                    <field name="mz_lot" />
                                    <field name="partner_id"   optional="show" />
                                    <field name="last_payment_date_land"  optional="hidden" />
                                    <field name="mounth_expired_land"  optional="hidden" />
                                    <field name="validity_date" widget="remaining_days" />
                                    <field name="next_payment_date_land" />
                                    <field name="days_expired_land" />
                                    <field name="mora_acumulada" optional="hidden" />

                                    <!--<field name="name" optional="hiden" /> -->
                                    <field name="seller_land_id" optional="hidden" />
                                    <field name="stage_land" widget="badge" />
                                    <field name="stage_payment_lan" widget="badge"
                                           decoration-success="stage_payment_lan == 'payment'"
                                           decoration-warning="stage_payment_lan == 'initial'"
                                    />
                                    <field name="state" optional="hidden" />
                                    <field name="dues_land" />
                                    <field name="qty_dues_payment" />
                                    <button name="show_dues_land" string="Pagos" type="object" />
                                    <field name="amount_total"  optional="hidden" />
                                    <field name="price_initial_land" string="Inicial"  optional="hidden" />
                                    <field name="price_credit_land" string="Credito" />
                                    <field name="total_payment_land" string="Abonado" />
                                    <field name="saldo_payment_land"  string="Saldo" />
                                    <field name="state_lawyer_land"  optional="hidden" />
                                    <field name="obs_resolution"  optional="hidden" />


                                </tree>
           </field>
    </record>


    <record id="action_move_adelantos1" model="ir.actions.act_window">
        <field name="name">Facturas sin CotizaciÃ³n</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">account.move</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('is_separation_land','=',True),('move_type', '=', 'out_invoice'),('sale_order_count_store','=',0)]</field>
        <field name="context">{
            'default_is_separation_land': True ,
            'default_move_type': 'out_invoice' ,
            'default_stage_separation_land': 'active' ,
            }</field>
        <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('land.view_invoice_tree_jz')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('account.view_move_form')})]"
            />
    </record>


    <record id="action_move_adelantos2" model="ir.actions.act_window">
        <field name="name">Todas las Separaciones</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">account.move</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('is_separation_land','=',True),('move_type', '=', 'out_invoice')]</field>
        <field name="context">{'default_is_separation_land': True , 'default_move_type': 'out_invoice' }</field>
        <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('land.view_invoice_tree_jz')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('account.view_move_form')})]"
            />
    </record>
    <record id="action_sale_separation" model="ir.actions.act_window">
        <field name="name">Separacion con CotizaciÃ³n</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.order</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('stage_payment_lan','in',['separation'])]</field>

        <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('land.view_order_tree_separacion')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('sale.view_order_form')})]"
            />
    </record>


    <record id="action_sale_initial_incomplete" model="ir.actions.act_window">
        <field name="name">Inicial Pendiente con CotizaciÃ³n</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.order</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('stage_payment_lan','in',['initial'])]</field>

        <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('land.view_order_tree_separacion')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('sale.view_order_form')})]"
            />
    </record>




    <menuitem name="Separaciones"
              id="menu_move_adelantos"
              parent="sale.sale_order_menu"
    />

    <menuitem action="action_move_adelantos2"
              id="menu_move_adelantos2"
              parent="menu_move_adelantos"
              sequence="0" />

    <menuitem action="action_move_adelantos1"
              id="menu_move_adelantos1"
              parent="menu_move_adelantos"
              sequence="1"
    />

    <menuitem action="action_sale_separation"
              id="menu_sale_separation"
              parent="menu_move_adelantos"
              sequence="2"
    />


    <menuitem action="action_sale_initial_incomplete"
              id="menu_sale_initial_incomplete"
              parent="menu_move_adelantos"
              sequence="3"
    />



    <record id="action_sale_dues_incomplete" model="ir.actions.act_window">
        <field name="name">Expedientes de clientes</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.order</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[
            ('stage_payment_lan','in',['payment','dues']),('state','in',['sale','done']) ,
            ('stage_land','!=','cancel')

            ]</field>
        <!--<field name="context">{'search_default_vencido_x_vencer': 1}</field> -->
        <field name="context">{}</field>
    </record>

    <menuitem action="action_sale_dues_incomplete"
              id="menu_sale_dues_incomplete"
              parent="sale.sale_order_menu"
    />

    <record id="action_sale_dues_complete" model="ir.actions.act_window">
        <field name="name">Expendientes Pagos Completados</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.order</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('stage_payment_lan','=','completed')]</field>
    </record>

    <menuitem action="action_sale_dues_complete"
              id="menu_sale_dues_complete"
              parent="sale.sale_order_menu" />


    <record id="view_order_tree_preaviso_cancelx" model="ir.ui.view">
           <field name="name">sale.order.Form</field>
           <field name="model">sale.order</field>
           <field name="arch" type="xml">
               <tree>
                   <field name="nro_internal_land" />
                   <field name="mz_lot" />
                   <field name="partner_id" />
                   <field name="stage_land" />
                   <field name="mounth_expired_land" />
                   <field name="value_due_land" />
                   <field name="mora_acumulada" />
                   <field name="saldo_payment_land" string="Total de Deuda" />
                   <field name="state_lawyer_land" />
                   <field name="obs_resolution" />
               </tree>
           </field>
    </record>

    <record id="action_sale_resueltosx" model="ir.actions.act_window">
        <field name="name">Expendientes Resueltos y Carta Pre Aviso</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.order</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('stage_land','=','cancel')]</field>

        <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('land.view_order_tree_preaviso_cancelx')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('sale.view_order_form')})]"
            />
    </record>

    <menuitem action="action_sale_resueltosx"
              id="menu_sale_dues_resueltos"
              parent="sale.sale_order_menu" />


    <record id="view_order_tree_report" model="ir.ui.view">
           <field name="name">sale.order.Form</field>
           <field name="model">sale.order</field>
           <field name="arch" type="xml">
               <tree string="Ventas"
                                      decoration-danger="mounth_expired_land >= 3"
                                       decoration-warning="mounth_expired_land >= 2"
                                >
                                    <field name="nro_internal_land" />
                                    <field name="mz_lot" />
                                    <field name="partner_id"   optional="hidden" />
                                    <field name="last_payment_date_land"  optional="hidden" />

                                    <field name="next_payment_date_land" />
                                    <field name="mounth_expired_land"  optional="show" />
                                    <field name="days_expired_land" />
                                    <field name="mora_acumulada" optional="hidden" />

                                    <!--<field name="name" optional="hiden" /> -->
                                    <field name="seller_land_id" optional="hidden" />


                                    <field name="stage_land" widget="badge" />
                                    <field name="stage_payment_lan" widget="badge" decoration-success="stage_payment_lan == 'payment'" />
                                    <field name="state" optional="hidden" />
                                    <field name="dues_land" />
                                    <field name="qty_dues_payment" />
                                    <button name="show_dues_land" string="Pagos" type="object" />
                                    <field name="amount_total"  optional="hidden" />
                                    <field name="price_initial_land" string="Inicial"  optional="hidden" />
                                    <field name="price_credit_land" string="Credito" />
                                    <field name="total_payment_land" string="Abonado" />
                                    <field name="saldo_payment_land"  string="Saldo" />
                                    <field name="state_lawyer_land"  optional="hidden" />
                                    <field name="obs_resolution"  optional="hidden" />

                                </tree>
           </field>
    </record>






</odoo>